<odoo>
  <data>
     <!-- Accion Menu Eliminar -->
		<act_window id="action_set_mail_mail_delete"
		    multi="True" 
            name="Borrar Correos"
            src_model="mail.mail"
            res_model="mail.mail.delete"
            view_type="form" view_mode="form"
            key2="client_action_multi" target="new"
        />

   <record model="ir.ui.view" id="view_email_eliminar_form">
        <field name="name">Eliminar Emials</field>
        <field name="model">mail.mail.delete</field>
        <field name="arch" type="xml">
            <form string="Eliminar">
			<sheet>
			<h1>Confirmar Eliminar Correos Enviados</h1>
            <field name="name" invisible="1"/>
			<!-- 
			<group>
			<field name="mails_ids"/>
			</group>
			-->
			</sheet>
			<footer>
			  <button string="Eliminar" name="wizard_method" type="object"/>
			  <button name="cancel" string="Cancelar" special="cancel"/>
			</footer>
            </form>
        </field>
    </record>
	

		<act_window id="action_set_mail_message_delete"
		    multi="True" 
            name="Borrar Correos"
            src_model="mail.message"
            res_model="mail.message.delete"
            view_type="form" view_mode="form"
            key2="client_action_multi" target="new"
        />

   <record model="ir.ui.view" id="view_email_eliminar_recepcion_form">
        <field name="name">Eliminar Emials</field>
        <field name="model">mail.message.delete</field>
        <field name="arch" type="xml">
            <form string="Eliminar">
			<sheet>
			<h1>Confirmar Eliminar Correos Entrantes</h1>
            <field name="name" invisible="1"/>
			<!-- 
			<group>
			<field name="mails_ids"/>
			</group>
			-->
			</sheet>
			<footer>
			  <button string="Eliminar" name="wizard_method" type="object"/>
			  <button name="cancel" string="Cancelar" special="cancel"/>
			</footer>
            </form>
        </field>
    </record>

	
	
	
    <!-- Vista Búsueda Entrante -->
    <record model="ir.ui.view" id="view_email_entrante_search">
        <field name="name">Buscador Emials Entrantes</field>
        <field name="model">mail.message</field>
        <field name="arch" type="xml">
            <search string="Emails Entrantes">
                    <field name="email_from"/>
                    <field name="subject"/>
					<field name="date"/>
					<field name="etiquetas"/>
					<field name="bandejaentrada"/>
					<field name="procesado_por"/>
					<field name="procesado_cuando"/>
					<separator/>
                    <filter string="Tiene Adjuntos" name="attachments" domain="[('attachment_ids', '!=', False)]"/>
					<filter string="Destacado" name="destacado" domain="[('destacar', '!=', False)]"/>
					<filter string="Pendientes" name="pendientes" domain="[('procesado', '!=', True)]"/>
                    <group expand="0" string="Group By">
                        <filter name="group_email_from" string="Origen" context="{'group_by':'email_from'}"/>
                        <filter string="Fecha" name="group_date" context="{'group_by':'date'}"/>
						<filter string="Bandeja de Entrada" name="group_bandejaentrada" context="{'group_by':'bandejaentrada'}"/>
						<filter string="Quien los Procesa" name="group_quienprocesa" context="{'group_by':'procesado_por'}"/>
						<filter string="Cuando se Procesan" name="group_quienprocesa" context="{'group_by':'procesado_cuando'}"/>
                    </group>
					
            </search>
        </field>
    </record>

    <!-- Vista arbol Notificaciones -->
    <record model="ir.ui.view" id="view_notif_saliente_tree">
        <field name="name">Notificaciones de Odoo</field>
        <field name="model">mail.message</field>
        <field name="arch" type="xml">
            <tree string="Emails Entrantes" create="false" import="false" editable="top">
					<field readonly="1" name="destacar" invisible="1"/>
					<field name="procesado" invisible="1"/>
					<field readonly="1" name="message_type"/>
					<field readonly="1" name="model"/>
					<field readonly="1" name="res_id"/>
					<field readonly="1" name="date"/>
                    <field readonly="1" name="subject"/>
                    <field readonly="1" name="email_from"/>

            </tree>
        </field>
    </record>








    <!-- Vista arbol Entrante -->
    <record model="ir.ui.view" id="view_email_entrante_tree">
        <field name="name">Emials Entrantes</field>
        <field name="model">mail.message</field>
        <field name="arch" type="xml">
            <tree string="Emails Entrantes" import="false" delete="false" create="false">
                    <button name="" readonly="1" string="Procesado" icon="fa-lock text-warning" attrs="{'invisible': [('procesado', '!=', True)]}"/>
                    <button name="" readonly="1" string="Importante" icon="fa-tag" attrs="{'invisible': [('destacar', '!=', True)]}"/>
                    <field name="bandejaentrada"/>
					<field name="destacar" invisible="1"/>
					<field name="procesado" invisible="1"/>
					<field name="date"/>
                    <field name="subject"/>
                    <field name="email_from"/>
                    <field name="attachment_ids" widget="many2many_tags"/>
					<field name="etiquetas" widget="many2many_tags"/>
					<field name="rel_id" invisible="1"/>
					<field name="relacion" invisible="1"/>
					<field name="relacionstr2"/>

            </tree>
        </field>
    </record>
	
	    <!-- Vista Formulario Entrante -->
    <record model="ir.ui.view" id="view_email_entrante_form">
        <field name="name">Emials Entrantes</field>
        <field name="model">mail.message</field>
        <field name="arch" type="xml">	
			<form string="Message" create="false" delete="false">
                    <header>
					<button string="Reenviar"  icon="fa-mail-forward text-warning" type="object" name="reenviar"/>
					<button string="Responder" icon="fa-reply text-warning" type="object" name="responder"/>
					<!-- <button string="Buscar Correo" icon="fa-reload text-warning" type="object" name="buscarcorreo"/> -->
					<button string="Marcar Procesado" icon="fa-lock text-warning" type="object" name="button_procesado" attrs="{'invisible':[('procesado','=',True)]}"/>
					<button string="Volver a Pendiente" icon="fa-unlock text-warning" type="object" name="button_procesado" confirm="¿Quieres volver el Email a Estado pendiente?"  attrs="{'invisible':[('procesado','!=',True)]}"/>
					<button string="Borrar Correo" icon="fa-trash text-warning" type="object" name="borrar" confirm="¿Estás Seguro que quieres eliminar este correo?"/>
					</header>
					<sheet>
					<h2>EMAIL ENTRANTE</h2>
                    <div class="alert alert-info" role="alert" style="margin-bottom:0px;" attrs="{'invisible': [('procesado','!=',True)]}">
                      <center><h2>El Email Figura Procesado por el Usuario: <field name="procesado_por" readonly="1"/> el <field name="procesado_cuando" readonly="1"/></h2></center>
                    </div>                    

					<group>
                            <group>
                                <field name="bandejaentrada" readonly="1"/>
								<field name="subject" readonly="1"/>
                                <field name="date" readonly="1"/>
                                <field name="email_from" readonly="1"/>
                                <field name="author_id"/>
                                <field name="record_name" invisible="1"/>
                                <field name="moderator_id" invisible="1"/>
                            </group>
                            <group>
                                <field name="parent_id" invisible="1"/>
                                <field name="model" invisible="1"/>
                                <field name="res_id" invisible="1"/>
								<field name="starred" invisible="1"/>
								<field name="destacar"/>
								<field name="procesado" invisible="1"/>
								<field name="etiquetas" widget="many2many_tags"/>
								<field name="rel_id" invisible="1"/>
								<field name="relacion" options="{'no_create': True}" attrs="{'readonly':['|',('procesado', '=', True),('relsel', '=', True)]}"/>
								<field name="relsel" invisible="1" />
                                <label for="tareas" attrs="{'invisible':[('rel_id','!=','project.task')]}"/>
								<div>
								  <field name="tareas" class="oe_inline"  options="{'no_create': True}"  attrs="{'invisible':[('rel_id','!=','project.task')],'readonly':[('procesado','=',True)]}"/>
								  <button string="Nueva Tarea" class="oe_edit_only " type="object" name="crear_tarea_tmp" attrs="{'invisible':['|',('tareas','!=',False),('rel_id','!=','project.task')]}"/>	
								</div>
                                <label for="ticket" attrs="{'invisible':[('rel_id','!=','helpdesk_lite.ticket')]}"/>
                                <div>
								  <field name="ticket"  options="{'no_create': True}" class="oe_inline" attrs="{'invisible':[('rel_id','!=','helpdesk_lite.ticket')],'readonly':[('procesado','=',True)]}"/>
                                  <button string="Nuevo Ticket" class="oe_edit_only " type="object" name="crear_ticket_tmp" attrs="{'invisible':['|',('ticket','!=',False),('rel_id','!=','helpdesk_lite.ticket')]}"/>	
								  <!-- <button string="Selecciona" class="oe_edit_only " type="object" name="seleccionar_ticket" attrs="{'invisible':['|',('ticket','=',False),('rel_id','!=','helpdesk_lite.ticket')]}"/> -->
								</div>
                                <button string="Elimina Relación" class="oe_edit_only" type="object" name="elimina_relacion"/>
                                <field name="message_type" invisible="1"/>
                                <field name="subtype_id" invisible="1"/>
                                <field name="moderation_status" invisible="1"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Body">
                                <field name="body" options="{'style-inline': true}" readonly="1"/>
                            </page>
                            <page string="Adjuntos">
                                <field name="attachment_ids" readonly="1">
								<tree>
								 <field name="datas_fname"/>
								 <field name="file_size"/>
								  <field name="datas" widget="file"/>
								</tree>
								</field>
                            </page>
							<page string="Seguimiento" invisible="1">

                            <field name="seguimiento_id">
							<tree delete="false" create="false">
<field name="write_date" string="Fecha"/>
                                  <field name="name"/>
								  <button type="object" name="action_open_origen" string="Documento Origen"/>
                                  <field name="name_destino"/>
								  <button type="object" name="action_open_destino" string="Documento Destino"/>
								  
					              
								  </tree>
							</field>
                        </page>
                            <page string="Más">
                                <group>
                                    <group>
                                        <field name="reply_to" readonly="1"/>
                                        <field name="no_auto_thread" invisible="1"/>
                                    </group>
                                    <group>
                                        <field name="message_id"/>
                                        <field name="mail_server_id" invisible="1"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Recipients">
                                <group>
                                    <group>
                                        <field name="partner_ids" widget="many2many_tags"/>
                                        <field name="channel_ids" widget="many2many_tags" invisible="1"/>
                                    </group>
                                    <group>
                                        <field name="needaction_partner_ids" widget="many2many_tags" invisible="1"/>
                                        <field name="starred_partner_ids" widget="many2many_tags" invisible="1"/>
                                    </group>
                                </group>
                                <group>
                                    <field name="notification_ids">
                                        <tree>
                                            <field name="res_partner_id"/>
                                            <field name="is_read"/>
                                            <field name="is_email"/>
                                            <field name="email_status"/>
                                        </tree>
                                    </field>
                                </group>
                            </page>
                            <page string="Tracking" invisible="1">
                                <field name="tracking_value_ids"/>
                            </page>
                        </notebook>
                    </sheet>
					
                </form>
             </field>
    </record>
	
	
	
    <!-- Vista Búsueda Saliente -->
    <record model="ir.ui.view" id="view_email_salientes_search">
        <field name="name">Buscador Emials Salientes</field>
        <field name="model">mail.mail</field>
        <field name="arch" type="xml">
            <search string="Emails Entrantes">
                    <field name="email_to"/>
                    <field name="email_from"/>
                    <field name="subject"/>
					<field name="date"/>
					<separator/>
                    <filter string="Pendientes de Enviar" name="pteenv" domain="[('state', '=', 'outgoing')]"/>
					<filter string="Enviados" name="env" domain="[('state', '=', 'sent')]"/>
					<filter string="Error Al Enviar" name="env" domain="[('state', '=', 'exception')]"/>
					<separator/>
                    <filter string="Tiene Adjuntos" name="attachments" domain="[('attachment_ids', '!=', False)]"/>
                    <group expand="0" string="Group By">
                        <filter name="group_email_to" string="Destino" context="{'group_by':'email_to'}"/>
						<filter name="group_email_from" string="Origen" context="{'group_by':'email_from'}"/>
                        <filter string="Fecha" name="group_date" context="{'group_by':'date'}"/>
                    </group>
					
            </search>
        </field>
    </record>
    <!-- Vista Arbol Saliente -->
    <record model="ir.ui.view" id="view_email_saliente_tree">
        <field name="name">Emials Salientes</field>
        <field name="model">mail.mail</field>
        <field name="arch" type="xml">
        <tree string="Emails" import="false" delete="false" decoration-muted="state in ('sent', 'cancel')" decoration-info="state=='outgoing'" decoration-danger="state=='exception'">
                    <field name="date"/>
                    <field name="subject"/>
                    <field name="author_id" string="User"/>
                    <field name="message_id" invisible="1"/>
					<field name="email_to" />
                    <field name="recipient_ids" widget="many2many_tags"/>
                    <field name="model" invisible="1"/>
                    <field name="res_id" invisible="1"/>
                    <field name="email_from" invisible="1"/>
                    <field name="state"/>
					<field name="borrado" invisible="1"/>
                    <field name="message_type" invisible="1"/>
                    <button name="send" string="Send Now" type="object" icon="fa-paper-plane text-success" states="outgoing"/>
                    <button name="mark_outgoing" string="Retry" type="object" icon="fa-repeat text-success" states="exception,cancel"/>
                    <button name="cancel" string="Cancel Email" type="object" icon="fa-times-circle text-danger" states="outgoing"/>
                </tree>
        </field>
    </record>	
	    <!-- Vista Formulario Saliente -->
	  <record model="ir.ui.view" id="view_email_saliente_form">
        <field name="name">Emials Salientes</field>
        <field name="model">mail.mail</field>
        <field name="arch" type="xml">	
	    <form string="Email message" import="false" delete="false">
                    <header>
                        <button name="send" string="Enviar Ahora" type="object" states="outgoing" class="oe_highlight"/>
                        <button name="mark_outgoing" string="Reintentar Envío" type="object" states="exception,cancel"/>
                        <button name="cancel" string="Cancelar" type="object" states="outgoing"/>
                        <field name="state" widget="statusbar" statusbar_visible="outgoing,sent,received,exception,cancel"/>
						<button name="reenviar" string="Reenviar" type="object" icon="fa-mail-forward text-warning" context="{'default_composition_mode':'reply', 'default_parent_id': mail_message_id}"/>
						<button name="borrar" string="Borrar correo" type="object" icon="fa-trash text-warning" confirm="¿Estas Seguro de Eliminar el Correo?"/>
                    </header>
                    <sheet>
                        <field name="mail_message_id" required="0" invisible="1"/>
                        <label for="subject" class="oe_edit_only"/>
                        <h2><field name="subject"/></h2>
                        <div style="vertical-align: top;">
                            Fecha: <field name="date" readonly="1" class="oe_inline"/>
                            <!-- <button name="81" string="Reply" type="action" icon="fa-reply text-warning" context="{'default_composition_mode':'reply', 'default_parent_id': mail_message_id}" states="received,sent,exception,cancel"/> -->
                        </div>
                        <group>
                            <field name="email_from"/>
                            <field name="email_to"/>
                            <field name="recipient_ids" widget="many2many_tags"/>
                            <field name="email_cc"/>
							<field name="email_bcc"/>
                            
                            
                        </group>
                        <notebook>
                            <page string="Body">
                                <field name="body_html" widget="html" options="{'style-inline': true}"/>
                            </page>
							<!--
							<page string="Firmas">
							    <field name="usuario"/>
                                <field name="firma" widget="html"/>
                            </page>
							-->
							<page string="Adjuntos">
                                <field name="attachment_ids">
								<tree>
								 <field name="datas_fname"/>
								 <field name="file_size"/>
								  <field name="datas" widget="file"/>
								 
								</tree>
								</field>
                            </page>
                            <page string="Avanzados" groups="base.group_no_one">
                                <group>
                                    <group string="Status">
                                        <field name="auto_delete" invisible="1"/>
                                        <field name="notification" invisible="1"/>
                                        <field name="message_type"/>
										<field name="scheduled_date"/>
                                        <field name="mail_server_id"/>
                                        <field name="model" invisible="1"/>
                                        <field name="res_id" invisible="1"/>
                                    </group>
                                    <group string="Headers">
									    <field name="author_id" readonly="1" invisible="1"/>
										<field name="create_uid" string="Usuario" readonly="1"/>
									    <field name="reply_to"/>
                                        <field name="message_id"/>
                                        <field name="references"/>
                                        <field name="headers"/>
                                    </group>
                                </group>
                            </page>
                          
                            <page string="Failure Reason" attrs="{'invisible': [('state', '!=', 'exception')]}">
                                <field name="failure_reason"/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
              </field>
    </record>           
	
	
	


    <record id="view_email_server_usuariospermitidos_form" model="ir.ui.view">
        <field name="name">view_email_server_usuariospermitidos_form</field>
        <field name="model">fetchmail.server</field>
        <field name="inherit_id" ref="fetchmail.view_email_server_form"/>
        <field name="arch" type="xml">
            <data>
                <field name="object_id" position="after">
                    <field name="usuarios_ids" widget="many2many_tags"/>
                </field>
            </data>
        </field>
    </record>

	

<!-- **************************************** ACCIONES **************************************** -->

    <!-- Action Recibidos -->
    <record model="ir.actions.act_window" id="action_email_entrante">
        <field name="name">Emails Entrantes</field>
        <field name="res_model">mail.message</field>
        <field name="view_mode">tree,form</field>
		<field name="domain">[('message_type','=','email'),('model','=','pyme.mail.channel'),('usuarios_ids','in', uid),('borrado','!=',True)]</field>
        <field name="context">{"search_default_pendientes": 1}</field>
		<field name="search_view_id" ref="view_email_entrante_search"/>
		<field name="view_ids" eval="[(5, 0, 0),
                            (0, 0, {'view_mode': 'tree', 'view_id': ref('view_email_entrante_tree')}),
							(0, 0, {'view_mode': 'form', 'view_id': ref('view_email_entrante_form')}),]"/>
    </record>


    <!-- Action Enviados -->
    <record model="ir.actions.act_window" id="action_email_saliente">
        <field name="name">Emails Enviados</field>
        <field name="res_model">mail.mail</field>
        <field name="view_mode">tree,form</field>
		<field name="domain">[('borrado','!=',True)]</field>
        <field name="context">{"search_default_pteenv": 1}</field>
	    <field name="search_view_id" ref="view_email_salientes_search"/>
		<field name="view_ids" eval="[(5, 0, 0),
                            (0, 0, {'view_mode': 'tree', 'view_id': ref('view_email_saliente_tree')}),
							(0, 0, {'view_mode': 'form', 'view_id': ref('view_email_saliente_form')}),]"/>
    </record>

    <record model="ir.actions.act_window" id="action_notif_saliente">
        <field name="name">Notificaciones Enviadas</field>
        <field name="res_model">mail.message</field>
        <field name="view_mode">tree,form</field>
		<field name="domain">[('message_type','=','notification')]</field>
        <field name="context">{}</field>
	    <field name="search_view_id" ref="view_email_entrante_search"/>
		<field name="view_ids" eval="[(5, 0, 0),
                            (0, 0, {'view_mode': 'tree', 'view_id': ref('view_notif_saliente_tree')})]"/>
    </record>


    <!-- Action Etiquetas -->
    <record model="ir.actions.act_window" id="action_email_etiquetas">
        <field name="name">Etiquetas Correo Entrante</field>
        <field name="res_model">mail.message.etiquetas</field>
        <field name="view_mode">tree,form</field>
		<field name="domain"></field>
        <field name="context">{}</field>
    </record>




    <!-- Fin Acciones -->
    
    <!-- Menú principal -->
        <menuitem id="menu_emails"
		          web_icon="pyme_emails,static/menu/mail.png"
                  name="Email"/>

            <!-- Opciones -->

            <menuitem id="menu_email_entrante"
                      name="Recibidos"
                      action="action_email_entrante"
                      parent="menu_emails"
                      sequence="1"/>

            <menuitem id="menu_email_saliente"
                      name="Enviados"
                      action="action_email_saliente"
                      parent="menu_emails"
                      sequence="2"/>

            <!-- <menuitem id="menu_notif_saliente"
                      name="Notificaciones Enviadas"
                      action="action_notif_saliente"
                      parent="menu_emails"
                      sequence="3"/>
            -->

            <menuitem id="menu_email_configuraciones"
                      name="Configuración"
                      parent="menu_emails"
                      sequence="4"/>


            <menuitem id="menu_email_conf_etiquetas"
                      name="Etiquetas"
                      parent="menu_email_configuraciones"
                      action="action_email_etiquetas"
                      sequence="1"/>




    <!-- Fin Menú principal -->
  </data>
</odoo>